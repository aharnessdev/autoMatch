<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AutoMatch - New Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Patrick Hand', cursive;
        }
        /* Styles for selected buttons */
        .selected {
            background-color: #1a1a1a !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-white">
    <div class="w-full relative bg-white">
        <nav class="w-full h-20 bg-gradient-to-r from-[#bb4f17] to-black shadow">
            <div class="container mx-auto px-4 h-full flex items-center justify-between">
                <div class="flex items-center">
                    <img src="https://via.placeholder.com/189x80" alt="Logo" class="h-20">
                    <div class="ml-12 flex space-x-8">
                        <a href="nav.html" class="text-[#1b1a17] text-[22px] font-['Patrick Hand']">Home</a>
                        <a href="#" class="text-[#1b1a17] text-[22px] font-['Patrick Hand']">New Search</a>
                        <a href="favorites.html" class="text-[#1b1a17] text-[22px] font-['Patrick Hand']">Favorites</a>
                    </div>
                </div>
                <button class="bg-[#1a1a1a] text-white text-base px-4 py-3 rounded-lg border-4 border-[#1a1a1a]">Sign Out</button>
            </div>
        </nav>
        <!-- Styling and header -->
        <main class="container mx-auto px-8 py-8 mt-8">
            <h1 class="text-center text-black text-[22px] mb-8">Please fill out our short questionnaire so our AI can match you to your next car!</h1>
            <form id="carPreferencesForm" class="max-w-2xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Budget -->
                    <div class="flex flex-col">
                        <label for="budget" class="text-black text-[22px] mb-2">Budget:</label>
                        <select id="budget" name="budget[]" multiple class="w-full bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px] h-40 overflow-y-auto">
                            <option value="$5,000 - $10,000">$5,000 - $10,000</option>
                            <option value="$10,000 - $20,000">$10,000 - $20,000</option>
                            <option value="$20,000 - $30,000">$20,000 - $30,000</option>
                            <option value="$30,000 - $40,000">$30,000 - $40,000</option>
                            <option value="$40,000 - $50,000">$40,000 - $50,000</option>
                            <option value="$50,000 - $60,000">$50,000 - $60,000</option>
                            <option value="$60,000 - $70,000">$60,000 - $70,000</option>
                            <option value="$70,000 - $80,000">$70,000 - $80,000</option>
                            <option value="$80,000 - $90,000">$80,000 - $90,000</option>
                            <option value="$90,000 - $100,000">$90,000 - $100,000</option>
                            <option value="$100,000+">$100,000+</option>                            
                        </select>
                    </div>

                    <!-- New or Used (No Change) -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]">New or used?</label>
                        <div class="w-2/3 flex space-x-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="new_used" data-value="New">New</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="new_used" data-value="Used">Used</button>
                        </div>
                    </div>

                    <!-- Fuel Type -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]">Gas, electric, or hybrid?</label>
                        <div class="w-2/3 flex space-x-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="fuel_type" data-value="Gas">Gas</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="fuel_type" data-value="Electric">Electric</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="fuel_type" data-value="Hybrid">Hybrid</button>
                        </div>
                    </div>

                    <!-- Transmission -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]">Transmission type?</label>
                        <div class="w-2/3 flex space-x-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="transmission" data-value="Manual">Manual</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="transmission" data-value="Automatic">Automatic</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="transmission" data-value="CVT">CVT</button>
                        </div>
                    </div>

                    <!-- Passengers (No Change) -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]"># of Passengers?</label>
                        <div class="w-2/3 flex flex-wrap gap-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="1">1</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="2">2</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="3">3</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="4">4</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="5">5</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="6">6</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="7">7</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="passengers" data-value="8+">8+</button>
                        </div>
                    </div>

                    <!-- Drivetrain -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]">AWD, 4WD, FWD, or RWD?</label>
                        <div class="w-2/3 flex space-x-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="drivetrain" data-value="AWD">AWD</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="drivetrain" data-value="4WD">4WD</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="drivetrain" data-value="FWD">FWD</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="drivetrain" data-value="RWD">RWD</button>
                        </div>
                    </div>

                    <!-- Body Style -->
                    <div class="flex flex-col">
                        <label for="body_style" class="text-black text-[22px] mb-2">Body Style?</label>
                        <select id="body_style" name="body_style[]" multiple class="w-full bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px] h-40 overflow-y-auto">
                            <option value="Sedan">Sedan</option>
                            <option value="SUV">SUV</option>
                            <option value="Truck">Truck</option>
                            <option value="Coupe">Coupe</option>
                            <option value="Van">Van</option>
                            <option value="Convertible">Convertible</option>
                            <option value="Hatchback">Hatchback</option>
                            <option value="Wagon">Wagon</option>
                            <option value="Crossover">Crossover</option>
                            <option value="Minivan">Minivan</option>
                            <option value="Roadster">Roadster</option>
                            <option value="Pickup">Pickup</option>
                            <option value="Sportback">Sportback</option>
                            <option value="Liftback">Liftback</option>
                            <option value="Cabriolet">Cabriolet</option>
                            <option value="Supercar">Supercar</option>
                            <option value="Microcar">Microcar</option>
                            <option value="Off-Road Vehicle">Off-Road Vehicle</option>                            
                        </select>
                    </div>

                    <!-- MPG Preference -->
                    <div class="flex items-center">
                        <label class="w-1/3 text-black text-[22px]">MPG Preference?</label>
                        <div class="w-2/3 flex space-x-2">
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value=">10">>10</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value="10-20">10-20</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value="20-30">20-30</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value="30-40">30-40</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value="40-50">40-50</button>
                            <button type="button" class="option-button bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px]" data-field="mpg" data-value="<50"><50</button>                            
                        </div>
                    </div>

                    <!-- Make Preference -->
                    <div class="flex flex-col">
                        <label for="make_preference" class="text-black text-[22px] mb-2">Make Preference?</label>
                        <select id="make_preference" name="make_preference[]" multiple class="w-full bg-white border-2 border-[#1a1a1a] rounded-lg px-4 py-2 text-[18px] h-40 overflow-y-auto">
                            <option value="Acura">Any/No Preference</option>
                            <option value="Acura">Acura</option>
                            <option value="Alfa Romeo">Alfa Romeo</option>
                            <option value="Aston Martin">Aston Martin</option>
                            <option value="Audi">Audi</option>
                            <option value="BMW">BMW</option>
                            <option value="Bentley Motors">Bentley Motors</option>
                            <option value="Bugatti">Bugatti</option>
                            <option value="Buick">Buick</option>
                            <option value="Cadillac">Cadillac</option>
                            <option value="Chevrolet">Chevrolet</option>
                            <option value="Chrysler">Chrysler</option>
                            <option value="Dodge">Dodge</option>
                            <option value="Ferrari">Ferrari</option>
                            <option value="Fiat">Fiat</option>
                            <option value="Ford">Ford</option>
                            <option value="GMC">GMC</option>
                            <option value="Genesis">Genesis</option>
                            <option value="Honda">Honda</option>
                            <option value="Hummer">Hummer</option>
                            <option value="Hyundai">Hyundai</option>
                            <option value="Infiniti">Infiniti</option>
                            <option value="Jaguar">Jaguar</option>
                            <option value="Jeep">Jeep</option>
                            <option value="Kia">Kia</option>
                            <option value="Lamborghini">Lamborghini</option>
                            <option value="Land Rover">Land Rover</option>
                            <option value="Lexus">Lexus</option>
                            <option value="Lincoln">Lincoln</option>
                            <option value="Lotus">Lotus</option>
                            <option value="Maserati">Maserati</option>
                            <option value="Maybach">Maybach</option>
                            <option value="Mazda">Mazda</option>
                            <option value="McLaren">McLaren</option>
                            <option value="Mercedes-AMG">Mercedes-AMG</option>
                            <option value="Mercedes-Benz">Mercedes-Benz</option>
                            <option value="Mercury">Mercury</option>
                            <option value="Mini">Mini</option>
                            <option value="Mitsubishi">Mitsubishi</option>
                            <option value="Nissan">Nissan</option>
                            <option value="Oldsmobile">Oldsmobile</option>
                            <option value="Pontiac">Pontiac</option>
                            <option value="Porsche">Porsche</option>
                            <option value="Plymouth">Plymouth</option>
                            <option value="Ram">Ram</option>
                            <option value="Rivian">Rivian</option>
                            <option value="Rolls-Royce">Rolls-Royce</option>
                            <option value="Saab">Saab</option>
                            <option value="Saturn">Saturn</option>
                            <option value="Scion">Scion</option>
                            <option value="Smart">Smart</option>
                            <option value="Subaru">Subaru</option>
                            <option value="Suzuki">Suzuki</option>
                            <option value="Tesla">Tesla</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Volkswagen">Volkswagen</option>
                            <option value="Volvo">Volvo</option>                            
                        </select>
                    </div>
                </div>
                <!-- Submit button and styling -->
                <div class="mt-8 flex justify-center">
                    <button type="submit" id="match" class="bg-white border-2 border-[#1a1a1a] rounded-lg px-6 py-3 text-[22px] flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        Find your AutoMatch!
                    </button>
                    
                </div>

                <div class="loader hidden">
                    <svg class="car" width="102" height="40" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(2 1)" stroke="#002742" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
                            <path class="car__body" d="M47.293 2.375C52.927.792 54.017.805 54.017.805c2.613-.445 6.838-.337 9.42.237l8.381 1.863c2.59.576 6.164 2.606 7.98 4.531l6.348 6.732 6.245 1.877c3.098.508 5.609 3.431 5.609 6.507v4.206c0 .29-2.536 4.189-5.687 4.189H36.808c-2.655 0-4.34-2.1-3.688-4.67 0 0 3.71-19.944 14.173-23.902zM36.5 15.5h54.01" stroke-width="3"/>
                            <ellipse class="car__wheel--left" stroke-width="3.2" fill="#FFF" cx="83.493" cy="30.25" rx="6.922" ry="6.808"/>
                            <ellipse class="car__wheel--right" stroke-width="3.2" fill="#FFF" cx="46.511" cy="30.25" rx="6.922" ry="6.808"/>
                            <path class="car__line car__line--top" d="M22.5 16.5H2.475" stroke-width="3"/>
                            <path class="car__line car__line--middle" d="M20.5 23.5H.4755" stroke-width="3"/>
                            <path class="car__line car__line--bottom" d="M25.5 9.5h-19" stroke-width="3"/>
                        </g>
                    </svg>
                    
                        
                    </div>
                    </div>
            </form>
        </main>
    </div>

    <script type="module">
        // Object to store user selected options (arrays for multiple selections)
        const selectedOptions = {};

        // Initialize selectedOptions for each field to be multiple
        const multiSelectFields = ['fuel_type', 'transmission', 'drivetrain', 'mpg', 'new_used', 'passengers'];
        multiSelectFields.forEach(field => {
            selectedOptions[field] = [];
        });

        // Event listeners for the option buttons
        document.querySelectorAll('.option-button').forEach(button => {
            button.addEventListener('click', () => {
                const field = button.getAttribute('data-field');
                const value = button.getAttribute('data-value');

                // Check if the value is already selected
                const index = selectedOptions[field].indexOf(value);
                if (index > -1) {
                    // If selected, remove it
                    selectedOptions[field].splice(index, 1);
                    button.classList.remove('selected');
                } else {
                    // If not selected, add it
                    selectedOptions[field].push(value);
                    button.classList.add('selected');
                }
            });
        });

        // Handle form submission
        document.getElementById('match').addEventListener('click', function(event) {
            event.preventDefault();

            const formData = new FormData(document.getElementById('carPreferencesForm'));
            const userPreferences = {};

            const loader = document.querySelector('.loader');
            loader.classList.remove('hidden');


            // Collect data from multi-select fields
            const budget = formData.getAll('budget[]');
            const bodyStyle = formData.getAll('body_style[]');
            const makePreference = formData.getAll('make_preference[]');

            if (budget.length > 0) {
                userPreferences.budget = budget;
            }

            if (bodyStyle.length > 0) {
                userPreferences.body_style = bodyStyle;
            }

            if (makePreference.length > 0) {
                userPreferences.make_preference = makePreference;
            }

            // Add selected options from button-based fields
            for (const field in selectedOptions) {
                if (selectedOptions[field].length > 0) {
                    userPreferences[field] = selectedOptions[field];
                }
            }

            // Send data to backend
            fetch('http://localhost:3000/api/getCarRecommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userPreferences),
            })
            .then((response) => {
                if (!response.ok) {
                    return response.json().then((err) => {
                        throw new Error(err.error || 'Unknown error');
                    });
                }
                return response.json();
            })
            .then((data) => {
                console.log('Data received from backend:', data);

                // Stringify recommendations 
                const recommendationsString = JSON.stringify(data.recommendations);
                console.log('Stringified recommendations:', recommendationsString);

                // Store the recommendations for display on match.html
                localStorage.setItem('carRecommendations', recommendationsString);

                // Redirect to match.html 
                window.location.href = 'match.html';
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('An error occurred while generating recommendations. Please try again later.');
            });
        });
    </script>
</body>
</html>
